<?xml version="1.0" standalone="yes"?>
<!DOCTYPE entity [

  <!ELEMENT entity        (operacion*)>
  <!ELEMENT operacion     (input* , output* , listas? , dataset* , tables*, transformer?, forms)>
<!--   <!ELEMENT operacion     (input* , output* , dataset* , tables*, transformer?, forms)> -->
  
  <!ELEMENT input		  (campoEntrada*)>	<!--   Es la entrada de la operacion. Lo definido aquí llegará en un mapa a la operacion -->
  <!ELEMENT forms		  (form*)>		  	<!--   Para definir una restriccion y conocer que clients utilizan esta operacion. Es a modo de mantenimiento, por ejemplo: al cambiar una operacion, se debe saber quienes suelen llamar a la operacion para realizar los debidos cambios -->
  <!ELEMENT output		  (campoSalida*)> 	<!--   Define el formato de salida -->
  <!ELEMENT transformer	  EMPTY>			<!--   Define una clase que es la encargada de mostrar los resultados en la salida de la operacion. (Muchas tablas, una sola, en paralelo) -->
  
  <!ELEMENT listas		  (lista*)>			<!--   Son las listas para mostrar en la salida-->

  <!ELEMENT lista  (lista*)>  
  <!ATTLIST lista nombreWriter		CDATA    #REQUIRED>
  <!ATTLIST lista nombreLista       CDATA    #REQUIRED>


  <!ELEMENT campoEntrada  (input*|campoEntrada*)>  
  <!ELEMENT campoSalida   (campoSalida*,output*)>  
  
  <!ELEMENT dataset       (campo*)>
  <!ELEMENT campo         EMPTY>
  <!ELEMENT tables       (tableDef+)>
  <!ELEMENT tableDef     (campoTable*)>
  <!ELEMENT campoTable   EMPTY>
  
  <!ATTLIST transformer clase           CDATA #REQUIRED>
  
  <!ATTLIST form name	CDATA #REQUIRED>
  
  <!ATTLIST input name           	 	CDATA    #IMPLIED><!--   Nombre que se corresponde con la entrada de delphi. Si en delphi mandan el valor Name, acá debe exstir en valor Name para obtener los demas datos -->
  <!ATTLIST input keyName           	CDATA    #IMPLIED><!--   Indica el key del mapa que llega a la operacion. Si el valor es 'leo', se debera recuperar usando la key 'leo' sobre el mapa en la operacion -->
  <!ATTLIST input clase           	 	CDATA    #IMPLIED><!-- 	define la clase del parmetro recibido -->
  <!ATTLIST input fieldID           	CDATA    #IMPLIED><!--   Define que atributo sera utilizado como id de la entida, esto es para recuperarlo de la base, si acá el valor es UN_ID, en delphi deberian mandar el valor UN_ID -->
  <!ATTLIST input nombreEntidad        	CDATA    #IMPLIED>
  
  <!ATTLIST campoEntrada name			CDATA #IMPLIED>
  <!ATTLIST campoEntrada clase			CDATA #IMPLIED>
  <!ATTLIST campoEntrada nombreEntidad	CDATA #IMPLIED>
  <!ATTLIST campoEntrada metodo			CDATA #IMPLIED>
  <!ATTLIST campoEntrada fieldID        CDATA #IMPLIED><!--   Define que atributo sera utilizado como id de la entida, esto es para recuperarlo de la base, si acá el valor es UN_ID, en delphi deberian mandar el valor UN_ID -->
 
  <!ATTLIST output name					CDATA #REQUIRED> 
  <!ATTLIST output tableName           	CDATA #REQUIRED><!-- va a representar el nombre de la tabla -->

  <!ATTLIST campoSalida tableName		CDATA #IMPLIED> <!-- en caso de ser hijo de otro campoSalida, es una tabla, y este campo tendra el nombre de la tabla -->
  <!ATTLIST campoSalida target			CDATA #IMPLIED> <!-- El nombre del metodo para recuperar los datos -->
  <!ATTLIST campoSalida value			CDATA #IMPLIED> <!-- el valor de la columna que contendra el valor de resltado de target -->

  <!ATTLIST operacion name              ID    #REQUIRED>
  <!ATTLIST operacion clase             CDATA #IMPLIED>
  <!ATTLIST operacion entidad           CDATA #IMPLIED>
  <!ATTLIST operacion XMLWriter         CDATA #IMPLIED>
  <!ATTLIST operacion redirect          CDATA #IMPLIED>
  <!ATTLIST operacion usaJMS            CDATA #IMPLIED>
  
  <!ATTLIST dataset name                CDATA #REQUIRED>
  <!ATTLIST dataset value               CDATA #IMPLIED>
  <!ATTLIST dataset tabla               CDATA #IMPLIED>
  
  <!ATTLIST campo   name                CDATA #REQUIRED>
  <!ATTLIST campo   value               CDATA #IMPLIED>
  
  <!ATTLIST tableDef    name           	CDATA #REQUIRED>

  <!ATTLIST campoTable	name        	CDATA #REQUIRED>
  <!ATTLIST campoTable  orden       	CDATA #IMPLIED>
  <!ATTLIST campoTable  tipo        	CDATA #IMPLIED>
  <!ATTLIST campoTable  longitud    	CDATA #IMPLIED>
  
]>

<entity>

	<operacion name="GuardarModeloCotizador" clase="com.jkt.cotizador.operaciones.GuardarModeloCotizador">
	
		<input name="mtCab" keyName="modelo" clase="com.jkt.cotizador.dominio.ModeloCotizador" fieldID="oid_mod">
			<campoEntrada>

				<campoEntrada name="cod_mod" clase="String" metodo="setCodigo" />
				<campoEntrada name="des_mod" clase="String" metodo="setDescripcion" />
				<campoEntrada name="Activo" clase="Boolean" metodo="setActivo" />
				
				<campoEntrada name="mtDet" metodo="agregarTituloTransiente" clase="com.jkt.cotizador.dominio.TituloModeloCotizador" fieldID="oid_titu_conc">					
					<campoEntrada name="codInterno" clase="Integer" metodo="setCodigoInterno" />
					<campoEntrada name="codInternoPadre" clase="Integer" metodo="setCodigoInternoPadre" />
					<campoEntrada name="tipo" clase="String" metodo="setTipo" />
					
					<campoEntrada name="cod_titu_conc" clase="String" metodo="setCodigo" />
					<campoEntrada name="des_titu_conc" clase="String" metodo="setDescripcion" />

					<campoEntrada name="oid_conc" clase="com.jkt.cotizador.dominio.ConceptoPresupuesto" metodo="setConcepto" />					
				</campoEntrada>
				
			</campoEntrada>
		</input>
	
		<forms>
			<form name="FNVen0002"></form>
		</forms>

	</operacion>
	
	
	<!-- TRAER UN MODELO DE COTIZADOR, SUS TITULOS Y CONCEPTOS DE PRESUPUESTO -->
	<operacion name="TraerModeloCotizador" clase="com.jkt.cotizador.operaciones.TraerModeloCotizador">

		<output name="modelo" tableName="mtCab">
			<campoSalida value="oid_mod" target="id" />
			<campoSalida value="cod_mod" target="codigo" />
			<campoSalida value="des_mod" target="descripcion" />
		</output>

		<output name="titulos" tableName="mtDet">

			<campoSalida value="oid_titu_conc" target="id" />
			<campoSalida value="oid_mod" target="modeloCotizador.id" />
			<campoSalida value="codInterno" target="codigoInterno" />
			<campoSalida value="codInternoPadre" target="codigoInternoPadre" />
			<campoSalida value="cod_titu_conc" target="codigoReal" />
			<campoSalida value="des_titu_conc" target="descripcionReal" />
			<campoSalida value="tipo" target="tipo" />
			<campoSalida value="oid_conc" target="concepto.id" /> 

		</output>

		<transformer clase="com.jkt.transformers.ParalelResponseListenerTransformer"></transformer>

		<forms>
			<form name="---">
			</form>
		</forms>

	</operacion>

	<!-- 	Concepto de presupuesto -->
	<operacion name="TraerConceptoPresupuesto" clase="com.jkt.operaciones.TraerEntidades" entidad="com.jkt.cotizador.dominio.ConceptoPresupuesto">
		
		<output name="resultado" tableName="mtConc">
			<campoSalida value="oid_conc" target="id" />
			<campoSalida value="cod_conc" target="codigo" />
			<campoSalida value="des_conc" target="descripcion" />
			<campoSalida value="pide_art" target="isPideArticulo" />
			<campoSalida value="oid_val_cla" target="componenteValor.id" />
			<campoSalida value="cod_val_cla" target="componenteValor.codigo" />
			<campoSalida value="des_val_cla" target="componenteValor.descripcion" />
		</output>		

		<transformer clase="com.jkt.transformers.SimpleTransformer"></transformer>
		
		<forms>
			<form name="FNVen0001"></form>
		</forms>		

	</operacion>
	
	
	<operacion name="GuardarConceptoPresupuesto" clase="com.jkt.operaciones.GuardarLista">
	
		<input name="mtConc" keyName="objeto" clase="com.jkt.cotizador.dominio.ConceptoPresupuesto" fieldID="oid_conc">
			<campoEntrada>
				<campoEntrada name="cod_conc" clase="String" metodo="setCodigo" />
				<campoEntrada name="des_conc" clase="String" metodo="setDescripcion" />
				<campoEntrada name="pide_art" clase="Boolean" metodo="setPideArticulo" />
				<campoEntrada name="oid_val_cla" clase="com.jkt.varios.dominio.ComponenteValor" metodo="setComponenteValor" />
			</campoEntrada>
		</input>
	
		<forms>
			<form name="FNVen0001"></form>
		</forms>

	</operacion>
	
	
	<!-- 	CREACION DEL COTIZADOR. LA CREACION EN ESTE PUNTO ES BIEN BASICA. -->
	<operacion name="GuardarCotizacion" clase="com.jkt.operaciones.Guardar">
	
		<input name="cotizacion" keyName="objeto" clase="com.jkt.dominio.Cotizacion" fieldID="oid_cotiz">
			<campoEntrada>
<!-- 				<campoEntrada name="nro_cotiz" clase="Integer" metodo="setNro" /> ES GENERADO POR EL SISTEMA-->

<!-- 				<campoEntrada name="nombre" clase="String" metodo="setNombre" /> -->
<!-- 				<campoEntrada name="descripcion" clase="String" metodo="setDescripcion" /> Segun esta descripcion el usuario X seleccionará un modelo de cotizador -->

<!-- 				<campoEntrada name="estado" clase="String" metodo="setEstado" /> LO DA EL WORKFLOW -->

				<campoEntrada name="fecha" clase="Date" metodo="setFecha" />

				<campoEntrada name="oid_sucu" clase="com.jkt.erp.varios.ClienteSucursal" metodo="setClienteSucursal" />
<!-- 				<campoEntrada name="oid_clie" ref cliente /> -->
<!-- 				<campoEntrada name="nro_sucu" TRAER /> -->
<!-- 				<campoEntrada name="des_sucu" TRAER /> -->

<!-- 				<campoEntrada name="cod_clie" MOSTRAR ESTO EN LA SALIDA/> -->
<!-- 				<campoEntrada name="razonSocial" MOSTRAR ESTO EN LA SALIDA/> -->

				
				<campoEntrada name="oid_vend" clase="com.jkt.erp.varios.Vendedor" metodo="setVendedor" />
<!-- 				<campoEntrada name="cod_vend"  /> -->
<!-- 				<campoEntrada name="des_vend"  /> -->

				<campoEntrada name="oid_repre" clase="com.jkt.erp.varios.Representante" metodo="setRepresentante" />


				<campoEntrada name="oid_condicionPago" clase="com.jkt.varios.dominio.CondPago" metodo="setCondicionPago" />
				
				<campoEntrada name="comportamiento" clase="String" metodo="setComportamiento" />
				<campoEntrada name="lugarEmision" clase="String" metodo="setLugarEmision" />
				<campoEntrada name="anulado" clase="Boolean" metodo="setAnulado" />
				<campoEntrada name="tipoComprobante" clase="com.jkt.dominio.TipoComprobante" metodo="setTipoComprobante" />
				<campoEntrada name="letra" clase="Char" metodo="setLetra" />

				<campoEntrada name="cargaACargoDeCliente" clase="Boolean" metodo="setCargaACargoDeCliente" />
				<campoEntrada name="transporteACargoDeCliente" clase="Boolean" metodo="setTransporteACargoDeCliente" />
				<campoEntrada name="descargaACargoDeCliente" clase="Boolean" metodo="setDescargaACargoDeCliente" />

				
				<campoEntrada name="mtDetalleComprobanteVenta" metodo="agregarDetalle" clase="com.jkt.dominio.ComprobanteVentaDet" fieldID="oid_detalle">
					<campoEntrada name="oid_producto" clase="com.jkt.erp.articulos.Producto" metodo="setProducto" />
					<campoEntrada name="cantidad" clase="Integer" metodo="setCantidad" />
					<campoEntrada name="oid_unidadMedida" clase="com.jkt.varios.dominio.UnidadMedida" metodo="setUnidadMedida" />
					<campoEntrada name="precio" clase="Double" metodo="setPrecio" />
					<campoEntrada name="moneda" clase="com.jkt.varios.dominio.Moneda" metodo="setMoneda" />
					<campoEntrada name="oid_cotizador" clase="com.jkt.cotizador.dominio.Cotizador" metodo="setCotizador" />
				</campoEntrada>
				
			</campoEntrada>
		</input>
	
		<forms>
			<form name="-"></form>
		</forms>

	</operacion>
	
	<!-- RECUPERACION DE TODAS LAS ENTIDADES COTIZACION QUE AUN NO HAN SIDO REVISADAS -->
	<operacion name="TraerCotizacionesNoVisadas" clase="com.jkt.cotizador.operaciones.TraerCotizacionesNoVisadas" >
		
		<output name="cotizaciones" tableName="mtCotizador">
			<campoSalida value="id" target="id" />
			<campoSalida value="nombre" target="nombre" />
			<campoSalida value="descripcion" target="descripcion" />

			<campoSalida value="vendedor" target="vendedor.descripcion" />
			<campoSalida value="representante" target="representante.descripcion" />
			
			<campoSalida value="clienteSucursal" target="clienteSucursal.descripcion" />
<!-- 			<campoSalida value="clienteSucursal" target="clienteSucursal.descripcion" /> -->
			
			<campoSalida value="comportamiento" target="comportamiento" />
			<campoSalida value="letra" target="letra" />
			<campoSalida value="lugarEmision" target="lugarEmision" />
			<campoSalida value="nro" target="nro" />
			<campoSalida value="anulado" target="isAnulado" />
			<campoSalida value="tipoComprobante" target="tipoComprobante.descripcion" />
			
		</output>		

		<transformer clase="com.jkt.transformers.SimpleTransformer" />
		
		<forms>
			<form name="---"></form>
		</forms>		

	</operacion>
	
	
	<!-- CONFIGURACION DEL COTIZADOR. ESTA OPERACION SE EJECUTA AL MOMENTO DE GUARDAR EN EL COTIZADOR LA RELACION CON UN MODELO Y SUS CORRESPONDIENTES RELACIONES. -->
	<operacion name="ConfigurarCotizador" clase="com.jkt.operaciones.GuardarLista">
	
		<input name="mtCotizador" keyName="objeto" clase="com.jkt.cotizador.dominio.Cotizador" fieldID="oid_cot">
			<campoEntrada>
				<campoEntrada name="revisado" clase="Boolean" metodo="setRevisado" />
				<campoEntrada name="usuarioRevision" clase="String" metodo="setUsuarioRevision" />
				<campoEntrada name="fechaRevision" clase="Date" metodo="setFechaRevision" />
				<campoEntrada name="modelo" clase="com.jkt.cotizador.dominio.ModeloCotizador" metodo="setModelo" />
				
				<campoEntrada name="mtDetalleCotizador" metodo="agregarDetalle" clase="com.jkt.cotizador.dominio.CotizadorDet" fieldID="oid_detalle">
					<campoEntrada name="producto" clase="com.jkt.erp.articulos.Producto" metodo="setProducto" />
					<campoEntrada name="cantidad" clase="Integer" metodo="setCantidad" />
					<campoEntrada name="precioUnitario" clase="Double" metodo="setPrecioUnitario" />
					<campoEntrada name="cotizacion" clase="Double" metodo="setCotizacion" />

					<campoEntrada name="conceptoPresupuesto" clase="com.jkt.cotizador.dominio.ConceptoPresupuesto" metodo="setConceptoPresupuesto" />
					<campoEntrada name="unidadMedida" clase="com.jkt.varios.dominio.UnidadMedida" metodo="setUnidadMedida" />
					<campoEntrada name="moneda" clase="com.jkt.varios.dominio.Moneda" metodo="setMoneda" />
				</campoEntrada>
				
			</campoEntrada>
		</input>
		
		<forms>
			<form name="-"></form>
		</forms>

	</operacion>
	
	<!-- TRAER UN MODELO DE COTIZADOR, SUS TITULOS Y CONCEPTOS DE PRESUPUESTO -->
	<operacion name="TraerModeloParaCotizar" clase="com.jkt.cotizador.operaciones.TraerModeloParaCotizar">

		<output name="modelo" tableName="mtCab">
			<campoSalida value="oid_mod" target="id" />
			<campoSalida value="cod_mod" target="codigo" />
			<campoSalida value="des_mod" target="descripcion" />
		</output>

		<output name="titulos" tableName="mtDet">
			<campoSalida value="oid_titu_conc" target="id" />
			<campoSalida value="oid_mod" target="modeloCotizador.id" />
			<campoSalida value="codInterno" target="codigoInterno" />
			<campoSalida value="codInternoPadre" target="codigoInternoPadre" />
			<campoSalida value="cod_titu_conc" target="codigoReal" />
			<campoSalida value="des_titu_conc" target="descripcionReal" />
			<campoSalida value="tipo" target="tipo" />
			<campoSalida value="oid_conc" target="concepto.id" />
			
			<!-- Si el titulo pide articulo, se mostraran por cada titulo, que seria concepto, un producto separado por cada producto que tenga asignado el valor q se corresponde con el concepto. NO SE ENTIENDE MUCHO, EXPLICAR MEJOR... TODO -->
			<campoSalida value="oid_producto" target="producto.id" />
			<campoSalida value="des_producto" target="producto.descripcion" />

		</output>

		<transformer clase="com.jkt.transformers.ParalelResponseListenerTransformer"></transformer>

		<forms>
			<form name="---">
			</form>
		</forms>

	</operacion>
	
	
</entity>
